---
import type { Program as programProps } from '../tv/domain/Program';

interface Props {
  program: programProps[];
  count: number;
}

const { start, stop, title, subTitle, description, categories, image, rating, tvShow } = Astro.props.program[0];
const count = Astro.props.count;

function formatDateHours(date: Date): string {
    const d = date instanceof Date ? date : new Date(date);
    return `${String(d.getHours()).padStart(2, "0")}:${String(d.getMinutes()).padStart(2, "0")}`;
}

function timeOfProgram(startDate: Date, stopDate: Date): string {
    const start = startDate instanceof Date ? startDate : new Date(startDate);
    const stop = stopDate instanceof Date ? stopDate : new Date(stopDate);

    const diffInMinutes = Math.round((stop - start) / 60000);
    const hours = Math.floor(diffInMinutes / 60);
    const minutes = diffInMinutes % 60;

    if (hours === 0) {
        return `${minutes} min`;
    } else if (minutes === 0) {
        return `${hours}h`;
    } else {
        return `${hours}h${minutes.toString().padStart(2, "0")}`;
    }
}
---

<div class="flex mb-3 justify-between p-2 bg-gray-100 rounded-lg snap-center program" data-categories={categories?.join(" ")}>
    <div class="order-2">
        <object data={image} class="w-[65px] h-[90px] object-cover rounded-md">
            <img src="https://placehold.co/40x40?text=None" alt="default channel">
        </object>
    </div>
    <div class="order-1 flex flex-col">
        <div class="text-xs font-bold">{formatDateHours(start)}</div>
        <div class="mb-1">
            <h2 class="font-medium inline-block">{title}</h2>
            {tvShow?.season && tvShow?.episode ?
                <span class="text-xs text-gray-700">/ S{tvShow?.season}E{tvShow?.episode}</span> : ''
            }
        </div>
        <div class="text-xs mb-1 text-gray-900">
            {subTitle ? <p>{subTitle}</p> : null }
            {count > 1 ? <small>+ {count - 1} Ã©pisodes</small> : null}
        </div>
        {categories && categories.length > 0 ?
            <><div class="text-xs mb-1 text-gray-700">
                {categories[0]}
            </div></> : null
        }
        <div class="text-xs font-medium">{timeOfProgram(start, stop)}</div>
    </div>
</div>